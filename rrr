var cert = CertificateLoader.GetCertificate();
DumpCert(cert);

// Create handler
var handler = new HttpClientHandler
{
    ClientCertificateOptions = ClientCertificateOption.Manual,
    SslProtocols = SslProtocols.Tls12
};

// ðŸ‘‡ Place the custom validation callback here
handler.ServerCertificateCustomValidationCallback = (req, cert2, chain, errors) =>
{
    Console.WriteLine($"Server cert: {cert2.Subject}");
    Console.WriteLine($"Issuer: {cert2.Issuer}");
    Console.WriteLine($"Errors: {errors}");
    foreach (var ch in chain.ChainElements)
        Console.WriteLine($"  Chain: {ch.Certificate.Subject}");
    return false; // do NOT bypass yet â€” we just want to see details
};

// Then attach your client certificate
handler.ClientCertificates.Add(cert);

// Then create HttpClient
using var client = new HttpClient(handler)
{
    BaseAddress = new Uri(endpointUrl),
    Timeout = TimeSpan.FromSeconds(90)
};
