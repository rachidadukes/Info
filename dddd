Imports System.Security.Cryptography.X509Certificates
Imports System.Linq

Private Shared Function FindValidCertificateBySubjectName(subjectName As String) As X509Certificate2
    Dim certificate As X509Certificate2 = Nothing

    Using store As New X509Store("Remote Desktop", StoreLocation.LocalMachine)
        store.Open(OpenFlags.ReadOnly)

        Dim certificates As X509Certificate2Collection = store.Certificates

        certificate = certificates _
            .Cast(Of X509Certificate2)() _
            .FirstOrDefault()
    End Using

    Return certificate
End Function

