public async Task<string> CallRestServiceAsync(string xml)
{
    string endpointUrl = ConfigurationManager.AppSettings["MessageConverterURL"];
    string response = string.Empty;

    try
    {
        ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12;

        using (var handler = new HttpClientHandler())
        {
            handler.ServerCertificateCustomValidationCallback = (msg, cert, chain, errors) => true;

            using (var client = new HttpClient(handler))
            {
                client.Timeout = TimeSpan.FromSeconds(30);

                var content = new StringContent(xml, Encoding.UTF8, "application/xml");
                HttpResponseMessage resp = null;

                try
                {
                    resp = await client.PostAsync(endpointUrl, content);

                    int statusCode = (int)resp.StatusCode;
                    string reason = resp.ReasonPhrase;
                    string body = await resp.Content.ReadAsStringAsync();

                    Console.WriteLine($"Status Code: {statusCode} ({reason})");

                    // --- Handle different status codes explicitly ---
                    switch (statusCode)
                    {
                        case 200:
                            if (body.Contains("\"error\"") || body.Contains("<Error>"))
                            {
                                Console.WriteLine("‚ö†Ô∏è Logical error found in body (HTTP 200).");
                            }
                            else
                            {
                                Console.WriteLine("‚úÖ Success.");
                            }
                            break;

                        case 400:
                            Console.WriteLine("‚ùå Bad Request: check input parameters.");
                            break;

                        case 401:
                            Console.WriteLine("üîí Unauthorized: credentials or token invalid.");
                            break;

                        case 403:
                            Console.WriteLine("üö´ Forbidden: you do not have permission.");
                            break;

                        case 404:
                            Console.WriteLine("‚ùì Not Found: endpoint or resource missing.");
                            break;

                        case 500:
                            Console.WriteLine("üí• Internal Server Error: problem on the server.");
                            break;

                        default:
                            Console.WriteLine($"‚ö†Ô∏è Unexpected status: {statusCode} {reason}");
                            break;
                    }

                    // --- Combine diagnostic info ---
                    response =
                        $"HTTP {statusCode} {reason}\n" +
                        $"Body:\n{body}\n";

                    // Optional: log or save to file
                    File.AppendAllText("ApiLog.txt",
                        $"{DateTime.Now} - {statusCode} {reason}\n{body}\n----------------------\n");
                }
                catch (HttpRequestException httpEx)
                {
                    // Connection issues, DNS, SSL errors
                    response = $"NETWORK ERROR\n{httpEx}";
                    Console.WriteLine(response);
                }
                catch (TaskCanceledException tcEx)
                {
                    // Timeout
                    response = "TIMEOUT: The request took too long.\n" + tcEx.ToString();
                    Console.WriteLine(response);
                }
                catch (Exception ex)
                {
                    // Unexpected exception
                    response = "UNEXPECTED ERROR\n" + ex.ToString();
                    Console.WriteLine(response);
                }
            }
        }
    }
    catch (Exception outerEx)
    {
        response = "SETUP FAILURE\n" + outerEx.ToString();
        Console.WriteLine(response);
    }

    return response;
}
