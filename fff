public class ApiXmlClientNoCert2
{
    public async Task<string> GetResponseFromNewAPI(string xml)
    {
        string endpointUrl;
        string response = "";
        try
        {
            // Keep this here (no static ctor)
            ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12;
            ServicePointManager.Expect100Continue = false;   // optional but helps some gateways
            // DEV ONLY: uncomment if hitting self-signed endpoints
            // ServicePointManager.ServerCertificateValidationCallback = (s, cert, chain, e) => true;

            endpointUrl = ConfigurationManager.AppSettings["MessageConverterURL"];
            if (string.IsNullOrWhiteSpace(endpointUrl))
                return "CONFIG ERROR: 'MessageConverterURL' missing.";

            var handler = new HttpClientHandler();
            // If you‚Äôre on 4.7.1+, you can use the per-handler callback instead of global:
            // handler.ServerCertificateCustomValidationCallback = (m, c, ch, e) => true; // DEV ONLY

            using (var client = new HttpClient(handler))
            {
                client.Timeout = TimeSpan.FromSeconds(30);

                var content = new StringContent(xml, Encoding.UTF8, "application/xml");

                // NOTE: BaseAddress not needed since we pass the absolute URL below.
                HttpResponseMessage resp = await client.PostAsync(endpointUrl, content);

                // centralize the status/logic mapping
                string codeResponse = await ResponseResponses(resp);

                // return raw body on success; otherwise return the mapped message
                if (resp.IsSuccessStatusCode && !codeResponse.StartsWith("LOGICAL ERROR"))
                {
                    response = await resp.Content.ReadAsStringAsync();
                }
                else
                {
                    response = codeResponse;
                }
                return response;
            }
        }
        catch (TaskCanceledException tcex)
        {
            return "TaskCanceledException\n" + DiagnosticsUtil.ExceptionToString(tcex);
        }
        catch (HttpRequestException hrex)
        {
            return "HttpRequestException\n" + DiagnosticsUtil.ExceptionToString(hrex);
        }
        catch (AuthenticationException aex)
        {
            return "AuthenticationException\n" + DiagnosticsUtil.ExceptionToString(aex);
        }
        catch (Exception outerEx)
        {
            return "SETUP FAILURE\n" + outerEx;
        }
    }

    // keep your private helper ‚Äî just small polish
    private async Task<string> ResponseResponses(HttpResponseMessage resp)
    {
        int statusCode = (int)resp.StatusCode;
        string reason = resp.ReasonPhrase ?? "";
        string body = await resp.Content.ReadAsStringAsync();

        // Optional trace
        // Console.WriteLine($"Status Code: {statusCode} ({reason})");

        switch (statusCode)
        {
            case 200:
                if (body.IndexOf("error", StringComparison.OrdinalIgnoreCase) >= 0 ||
                    body.IndexOf("<Error", StringComparison.OrdinalIgnoreCase) >= 0)
                    return "LOGICAL ERROR found in body (HTTP 200).\n" + body;
                return "‚úì Success.";

            case 400: return "‚úñ Bad Request: check input parameters.\n" + body;
            case 401: return "üîí Unauthorized: credentials or token invalid.\n" + body;
            case 403: return "üö´ Forbidden: you do not have permission.\n" + body;
            case 404: return "‚ùì Not Found: endpoint or resource missing.\n" + body;
            case 415: return "üßæ Unsupported Media Type (ensure application/xml).\n" + body;
            case 500: return "‚ú¥ Internal Server Error: problem on the server.\n" + body;

            default:  return $"‚ö† Unexpected status: {statusCode} {reason}\n{body}";
        }
    }
}
=========================

private async Task<string> HandleHttpResponseAsync(HttpResponseMessage resp)

string codeResponse = await HandleHttpResponseAsync(resp);


