// Load appsettings.json
var settings = LoadAppSettings();

// Build your SOAP request (you already have SoapXMLRequest variable)
string originalXMLResponse;

if (MessageRouter.ShouldRouteToST(SoapXMLRequest))
{
    // Route to the new MessageConverter endpoint
    originalXMLResponse = await MessageRouter.SendToSTAsync(
        SoapXMLRequest,
        settings.MessageConverterUrl,
        settings.TimeoutSeconds,
        settings.ForceTranCode,
        settings.ForceTranCodeValue);
}
else
{
    // Route to the legacy member API
    var responseObject = new MemberSearchXMLresponse();
    originalXMLResponse = await responseObject.ReadXMLresponse(SoapXMLRequest, apiUrl);
}
