using Spectre.Console;

public static string? ShowMembersAndPickAccessNumber(MemberSearchRespDTO dto, int page = 0, int pageSize = 10)
{
    var members = dto?.Members ?? new List<Member>();
    var pageMembers = members.Skip(page * pageSize).Take(pageSize).ToList();
    if (pageMembers.Count == 0)
    {
        AnsiConsole.MarkupLine("[yellow]No members found.[/]");
        return null;
    }

    // Optional: print a header that looks like a table
    AnsiConsole.MarkupLine("[bold underline]Select a Member[/]");
    AnsiConsole.MarkupLine($"[grey]Page {page + 1} â€¢ Showing {pageMembers.Count} of {members.Count}[/]");

    var selected = AnsiConsole.Prompt(
        new SelectionPrompt<Member>()
            .Title("Use arrows to choose and press [green]Enter[/].")
            .PageSize(pageSize)
            .MoreChoicesText("[grey](Move up/down for more)[/]")
            .UseConverter(m =>
                // format columns (left-aligned with widths)
                $"{(m.CustPermId?.ToString() ?? ""),-12} " +
                $"{Markup.Escape(m.FullName ?? ""),-28} " +
                $"{Markup.Escape(m.AccessNumber ?? ""),-16} " +
                $"{Markup.Escape(m.Environment ?? "")}"
            )
            .AddChoices(pageMembers)
    );

    return selected?.AccessNumber;
}
