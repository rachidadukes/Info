
private static async Task<string> CNCBchanges(
    string soapXml,
    string apiUrl,
    string msgCategory,
    string hostAdapterAssembly)
{
    string response;

    // Decide where to route
    if (MessageRouter.ShouldRouteToST(soapXml))
    {
        // === send to new service (ST) ===
        response = await MessageRouter.SendToSTAsync(
            soapXml,
            ConfigHelper.LoadAppSettings().MessageConverterUrl,
            ConfigHelper.LoadAppSettings().TimeoutSeconds,
            ConfigHelper.LoadAppSettings().ForceTranCode,
            ConfigHelper.LoadAppSettings().ForceTranCodeValue
        );
    }
    else
    {
        // === legacy service path ===
        var legacy = new MemberSearchXMLresponse();
        response = await legacy.ReadXMLresponse(soapXml, apiUrl);

        // ⚠️ NOTE:
        // The legacy VB code also did things like:
        // ReplaceSpecialChars(sSendBuf) and
        // Sending(msgCategory, hostAdapterAssembly, sSendBuf, sRecvBuf)
        // You can stub those here if needed:
        //
        // soapXml = ReplaceSpecialChars(soapXml);
        // response = Sending(msgCategory, hostAdapterAssembly, soapXml, response);
    }

    return response;
}
