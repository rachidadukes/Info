HttpResponseMessage? resp = null;
try
{
    resp = await TryHeadOrGetAsync(client, healthUri, lastTlsErrors, serverCert, diag)
        .ConfigureAwait(false);
}
catch (HttpRequestException ex)
{
    diag.TlsOk = false;
    diag.HttpOk = false;
    diag.Reason = $"Request failed: {ex.Message}";
    return false;
}
catch (TaskCanceledException)
{
    diag.TlsOk = false;
    diag.HttpOk = false;
    diag.Reason = "Request timed out.";
    return false;
}
