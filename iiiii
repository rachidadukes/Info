private static HttpClientHandler CreateHandler(
    out SslPolicyErrors lastTlsErrors,
    out X509Certificate2? serverCert)
{
    // locals to capture inside lambda
    SslPolicyErrors localTlsErrors = SslPolicyErrors.None;
    X509Certificate2? localServerCert = null;

    var handler = new HttpClientHandler();

    handler.ServerCertificateCustomValidationCallback = (sender, cert, chain, errors) =>
    {
        localTlsErrors = errors;

        try
        {
            if (cert != null)
                localServerCert = new X509Certificate2(cert);
        }
        catch
        {
            // ignore errors converting the certificate
        }

        // âœ… TEMPORARY FIX: always trust for testing
        return true;
    };

    // assign captured values back to out parameters
    lastTlsErrors = localTlsErrors;
    serverCert = localServerCert;

    return handler;
}
