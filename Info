WITH Ranked AS (
    SELECT 
        Id,
        AccountNumber,
        AccessNumber,
        AccountType,
        Environment,
        TRIM(LOWER(AccountType)) AS NormalizedAccountType,
        ROW_NUMBER() OVER (
            PARTITION BY 
                AccountNumber, 
                AccessNumber, 
                TRIM(LOWER(AccountType)),  -- Normalize here too
                Environment
            ORDER BY Id
        ) AS RowNum
    FROM AccessAcctNumbers
)
SELECT 
    Id,
    AccountNumber,
    AccessNumber,
    NormalizedAccountType AS AccountType,
    Environment
FROM Ranked
WHERE RowNum > 1
ORDER BY AccountNumber;
