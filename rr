using System;
using System.Collections.Generic;
using System.Linq;
using System.Threading.Tasks;
using Microsoft.EntityFrameworkCore;

namespace ReadLiveLogsApp
{
    public static class RetrieveOriginalLogs
    {
        public static async Task<List<EventDetailsModel>> ReadOriginalLogs(
            DbContext context,
            string userId,
            DateTime fromDateTimeStamp,
            DateTime toDateTimeStamp)
        {
            try
            {
                // Build the query: by user, date range, not deleted, newest first
                var query = context.Set<EventDetailsModel>()
                    .Where(e =>
                        e.UserID == userId &&
                        e.DateTimeStamp >= fromDateTimeStamp &&
                        e.DateTimeStamp <= toDateTimeStamp &&
                        !e.Deleted)
                    .OrderByDescending(e => e.DateTimeStamp)
                    .AsAsyncEnumerable();

                var result = new List<EventDetailsModel>();

                // Stream results asynchronously
                await foreach (var e in query)
                {
                    // You can just add e directly if you donâ€™t need to clone
                    var log = new EventDetailsModel
                    {
                        EventID       = e.EventID,
                        DBID          = e.DBID,
                        EventDesc     = e.EventDesc,
                        EventSource   = e.EventSource,
                        DateTimeStamp = e.DateTimeStamp,
                        Deleted       = e.Deleted,
                        UserID        = e.UserID
                    };

                    result.Add(log);
                }

                return result;
            }
            catch (Exception ex)
            {
                Console.WriteLine($"Error while reading original logs: {ex.Message}");
                return new List<EventDetailsModel>();
            }
        }
    }
}



===========================


var helper = new DbContextFactoryHelper();
using var context = await helper.InitializeDbContextFactory(environment);

if (context is null)
{
    Console.WriteLine("Could not create DbContext.");
    return;
}

List<EventDetailsModel> logs =
    await RetrieveOriginalLogs.ReadOriginalLogs(context, userId, dateFrom, dateTo);






