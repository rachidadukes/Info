using System;
using System.Globalization;
using Spectre.Console;

namespace ConsoleApp10
{
    internal class Program
    {
        static void Main(string[] args)
        {
            // Default values (DateTime)
            DateTime defaultDateTo = DateTime.Today;
            DateTime defaultDateFrom = defaultDateTo.AddDays(-7);
            string defaultUserId = Environment.UserName; // or "testuser"

            AnsiConsole.MarkupLine("[bold cyan]User search parameters[/]");

            // Ask for User Id with default
            string userId = AnsiConsole.Prompt(
                new TextPrompt<string>("Enter [green]User Id[/]:")
                    .PromptStyle("yellow")
                    .DefaultValue(defaultUserId)
                    .ShowDefaultValue()
                    .Validate(input =>
                    {
                        if (string.IsNullOrWhiteSpace(input))
                            return ValidationResult.Error("[red]User Id cannot be empty[/]");
                        return ValidationResult.Success();
                    }));

            // Ask for DateFrom with default
            DateTime dateFrom = PromptForDate(
                "Enter [green]Date From[/] (yyyy-MM-dd):",
                defaultDateFrom);

            // Ask for DateTo with default, must be >= DateFrom
            // If the default "to" is earlier than the chosen "from", bump it up
            DateTime adjustedDefaultDateTo = defaultDateTo < dateFrom ? dateFrom : defaultDateTo;

            DateTime dateTo = PromptForDate(
                "Enter [green]Date To[/] (yyyy-MM-dd):",
                adjustedDefaultDateTo,
                dateFrom);

            // Now you can pass userId, dateFrom, dateTo to your method:
            // MyMethod(userId, dateFrom, dateTo);

            AnsiConsole.WriteLine();
            AnsiConsole.MarkupLine("[bold]Summary:[/]");
            AnsiConsole.MarkupLine($"User Id: [yellow]{userId}[/]");
            AnsiConsole.MarkupLine($"Date From: [yellow]{dateFrom:yyyy-MM-dd}[/]");
            AnsiConsole.MarkupLine($"Date To: [yellow]{dateTo:yyyy-MM-dd}[/]");

            AnsiConsole.MarkupLine("\nPress any key to exit...");
            Console.ReadKey();
        }

        private static DateTime PromptForDate(string promptText, DateTime defaultDate, DateTime? minDate = null)
        {
            while (true)
            {
                string input = AnsiConsole.Prompt(
                    new TextPrompt<string>(promptText)
                        .PromptStyle("yellow")
                        .DefaultValue(defaultDate.ToString("yyyy-MM-dd"))
                        .ShowDefaultValue());

                if (!DateTime.TryParseExact(
                        input,
                        "yyyy-MM-dd",
                        CultureInfo.InvariantCulture,
                        DateTimeStyles.None,
                        out DateTime date))
                {
                    AnsiConsole.MarkupLine("[red]Invalid date format. Use yyyy-MM-dd.[/]");
                    continue;
                }

                if (minDate.HasValue && date < minDate.Value)
                {
                    AnsiConsole.MarkupLine(
                        $"[red]Date must be on or after {minDate.Value:yyyy-MM-dd}.[/]");
                    continue;
                }

                return date;
            }
        }
    }
}
