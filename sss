using System;
using System.Net;
using System.Net.Http;
using System.Net.Security;
using System.Security.Cryptography.X509Certificates;

internal sealed class CertificateBypassScope : IDisposable
{
    private readonly RemoteCertificateValidationCallback _previous;

    private CertificateBypassScope(RemoteCertificateValidationCallback previous) => _previous = previous;

    public static CertificateBypassScope AllowAll()
    {
        // Use at your own risk; dev/test only.
        ServicePointManager.SecurityProtocol = SecurityProtocolType.Tls12;
        var prev = ServicePointManager.ServerCertificateValidationCallback;
        ServicePointManager.ServerCertificateValidationCallback = (sender, cert, chain, errors) => true;
        return new CertificateBypassScope(prev);
    }

    public void Dispose()
        => ServicePointManager.ServerCertificateValidationCallback = _previous;
}
