using Microsoft.Data.Sqlite;
using System;
using System.IO;
using System.Text;

public static class SqliteLogCopier
{
    /// <summary>
    /// Copies all rows for the given table names from sourceDbPath to destinationDbPath.
    /// For each table: DELETE destinationTable; INSERT INTO destinationTable SELECT * FROM sourceTable.
    /// All work is done in a single transaction. Returns true on success; false on error.
    /// </summary>
    public static bool CopyTables(
        string sourceDbPath,
        string destinationDbPath,
        out string errorMessage,
        params string[] tableNames)
    {
        errorMessage = string.Empty;

        try
        {
            if (!File.Exists(sourceDbPath))
                throw new FileNotFoundException("Source DB not found.", sourceDbPath);

            if (!File.Exists(destinationDbPath))
                throw new FileNotFoundException("Destination DB not found.", destinationDbPath);

            if (tableNames == null || tableNames.Length == 0)
                throw new ArgumentException("You must specify at least one table name.", nameof(tableNames));

            var destConnString = new SqliteConnectionStringBuilder
            {
                DataSource = destinationDbPath
            }.ToString();

            using var connection = new SqliteConnection(destConnString);
            connection.Open();

            using var transaction = connection.BeginTransaction();
            using var cmd = connection.CreateCommand();
            cmd.Transaction = transaction;

            // Build SQL: attach once, loop over tables, detach once
            var sb = new StringBuilder();
            sb.AppendLine("ATTACH DATABASE $srcPath AS SrcDb;");

            foreach (var table in tableNames)
            {
                // Simple safety: quote identifiers
                var safeTable = table.Replace("\"", "\"\""); // escape double quotes

                sb.AppendLine($@"DELETE FROM ""{safeTable}"";");
                sb.AppendLine($@"INSERT INTO ""{safeTable}"" SELECT * FROM SrcDb.""{safeTable}"";");
            }

            sb.AppendLine("DETACH DATABASE SrcDb;");

            cmd.CommandText = sb.ToString();
            cmd.Parameters.AddWithValue("$srcPath", sourceDbPath);

            cmd.ExecuteNonQuery();
            transaction.Commit();

            return true;
        }
        catch (FileNotFoundException ex)
        {
            errorMessage = $"File not found: {ex.FileName}";
            return false;
        }
        catch (SqliteException ex)
        {
            errorMessage = $"SQLite error while copying tables: {ex.Message}";
            return false;
        }
        catch (Exception ex)
        {
            errorMessage = $"Unexpected error while copying tables: {ex.Message}";
            return false;
        }
    }
}


==========================================

string error;
bool ok = SqliteLogCopier.CopyTables(
    @"C:\Path\To\SQLiteLogs.db",
    @"C:\Path\To\SQLiteLogsTransactions.db",
    out error,
    "LogDetails",
    "RequestResponse"   // second table
);

if (!ok)
{
    MessageBox.Show(error, "Copy Tables Failed");
}
else
{
    MessageBox.Show("Tables copied successfully.");
}
