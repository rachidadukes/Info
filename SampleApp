samples

public static string PrettyPrintXml(string xml)
{
    if (string.IsNullOrWhiteSpace(xml)) return xml;

    // Handles both fragments and full docs
    var settings = new XmlWriterSettings
    {
        Indent = true,
        IndentChars = "  ",
        NewLineChars = Environment.NewLine,
        NewLineHandling = NewLineHandling.Replace,
        OmitXmlDeclaration = false
    };

    // Try XDocument first (tolerates utf-16/utf-8 etc.)
    try
    {
        var doc = XDocument.Parse(xml, LoadOptions.PreserveWhitespace | LoadOptions.SetLineInfo);
        using var sw = new StringWriter();
        using (var xw = XmlWriter.Create(sw, settings))
            doc.Save(xw);
        return sw.ToString();
    }
    catch
    {
        // Fallback for fragments
        try
        {
            var xd = new XmlDocument();
            xd.PreserveWhitespace = false;
            xd.LoadXml(xml);
            using var sw = new StringWriter();
            using (var xw = XmlTextWriter.Create(sw, settings))
                xd.Save(xw);
            return sw.ToString();
        }
        catch
        {
            return xml; // show raw if totally invalid
        }
    }
}
