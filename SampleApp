samples

public static string PrettyPrintXml(string xml)
{
    if (string.IsNullOrWhiteSpace(xml))
        return xml;

    // Step 1: Trim whitespace
    xml = xml.Trim();

    // Step 2: Find where XML actually starts
    int xmlStart = xml.IndexOf('<');
    if (xmlStart > 0)
    {
        // Strip everything before the first '<'
        xml = xml.Substring(xmlStart);
    }

    // Step 3: Apply pretty printing
    var settings = new XmlWriterSettings
    {
        Indent = true,
        IndentChars = "  ",
        NewLineChars = System.Environment.NewLine,
        NewLineHandling = NewLineHandling.Replace,
        OmitXmlDeclaration = false
    };

    try
    {
        var doc = XDocument.Parse(xml, LoadOptions.PreserveWhitespace);
        using var sw = new StringWriter();
        using (var xw = XmlWriter.Create(sw, settings))
            doc.Save(xw);
        return sw.ToString();
    }
    catch
    {
        try
        {
            var xd = new XmlDocument();
            xd.PreserveWhitespace = false;
            xd.LoadXml(xml);
            using var sw = new StringWriter();
            using (var xw = XmlTextWriter.Create(sw, settings))
                xd.Save(xw);
            return sw.ToString();
        }
        catch
        {
            // If still invalid, just return the cleaned text
            return xml;
        }
    }
}
